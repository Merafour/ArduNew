# hw definition file for processing by chibios_pins.py
# for minimal F405 build

# MCU class and specific type
MCU STM32F4xx STM32F405xx

# board ID for firmware load
APJ_BOARD_ID 11

# crystal frequency
OSCILLATOR_HZ 24000000

# ChibiOS system timer
STM32_ST_USE_TIMER 5

FLASH_SIZE_KB 1024

# board voltage
STM32_VDD 330U

# the normal usage of this ordering is:
# 1) SERIAL0: console (primary mavlink, usually USB)
# 2) SERIAL3: primary GPS
# 3) SERIAL1: telem1
# 4) SERIAL2: telem2
# 5) SERIAL4: GPS2
# 6) SERIAL5: extra UART (usually RTOS debug console)
# order of UARTs
UART_ORDER OTG1 USART6 USART2

# order of I2C buses
I2C_ORDER I2C1

# now the first I2C bus. The pin speeds are automatically setup
# correctly, but can be overridden here if needed.
PB8 I2C1_SCL I2C1
PB9 I2C1_SDA I2C1
# this defines the default maximum clock on I2C devices.
define HAL_I2C_MAX_CLOCK 100000

# USART6 serial GPS
PC6 USART6_TX USART6
PC7 USART6_RX USART6
#PA2 BATT_VOLTAGE_SENS ADC1 SCALE(1)
#PA3 BATT_CURRENT_SENS ADC1 SCALE(1)
#PA4 VDD_5V_SENS ADC1 SCALE(2)

# USART2 is ESP8266
PA2 USART2_TX USART2
PA3 USART2_RX USART2

PA11 OTG_FS_DM OTG1
PA12 OTG_FS_DP OTG1

PA13 JTMS-SWDIO SWD
PA14 JTCK-SWCLK SWD

# the 2nd SPI bus
PB13 SPI2_SCK SPI2
PB14 SPI2_MISO SPI2
PB15 SPI2_MOSI SPI2

PC4 LPS22HB_CS CS
PC5 20608_CS CS
# the CS pin for FRAM (ramtron). This one is marked as using
# SPEED_VERYLOW, which matches the HAL_PX4 setup
PA8 FRAM_CS CS SPEED_VERYLOW


#define HAL_USE_EMPTY_STORAGE 1
define HAL_STORAGE_SIZE 15360
#define HAL_STORAGE_SIZE 16384
# enable RAMTROM parameter storage
define HAL_WITH_RAMTRON 1
define STORAGE_FLASH_PAGE 1
# reserve 32k for bootloader and 32k for flash storage
FLASH_RESERVE_START_KB 48

SPIDEV lps22h      SPI2 DEVID3  LPS22HB_CS   MODE3   1*MHZ   10*MHZ
SPIDEV icm20608    SPI2 DEVID6  20608_CS     MODE3   2*MHZ   8*MHZ
SPIDEV ramtron     SPI2 DEVID10 FRAM_CS      MODE3   2*MHZ   6*MHZ  

define HAL_BARO_DEFAULT HAL_BARO_LPS22H_SPI
define HAL_INS_DEFAULT HAL_INS_ICM20608_SPI
define HAL_COMPASS_DEFAULT HAL_COMPASS_IST8310
#define ALLOW_ARM_NO_COMPASS
#define HAL_COMPASS_DEFAULT HAL_COMPASS_NONE
#define HAL_INS_DEFAULT HAL_INS_NONE
#define HAL_BARO_DEFAULT HAL_BARO_NONE

/**
#define GPIO_TIM3_CH1OUT	(GPIO_ALT|GPIO_AF2|GPIO_SPEED_50MHz|GPIO_OUTPUT_CLEAR|GPIO_PUSHPULL|GPIO_PORTA|GPIO_PIN6)  //M4
#define GPIO_TIM3_CH2OUT	(GPIO_ALT|GPIO_AF2|GPIO_SPEED_50MHz|GPIO_OUTPUT_CLEAR|GPIO_PUSHPULL|GPIO_PORTB|GPIO_PIN5)  //M3
#define GPIO_TIM3_CH3OUT	(GPIO_ALT|GPIO_AF2|GPIO_SPEED_50MHz|GPIO_OUTPUT_CLEAR|GPIO_PUSHPULL|GPIO_PORTB|GPIO_PIN0)  //M2
#define GPIO_TIM3_CH4OUT	(GPIO_ALT|GPIO_AF2|GPIO_SPEED_50MHz|GPIO_OUTPUT_CLEAR|GPIO_PUSHPULL|GPIO_PORTB|GPIO_PIN1)  //M1
#define GPIO_TIM4_CH1OUT	(GPIO_ALT|GPIO_AF2|GPIO_SPEED_50MHz|GPIO_OUTPUT_CLEAR|GPIO_PUSHPULL|GPIO_PORTB|GPIO_PIN6)
#define GPIO_TIM4_CH2OUT	(GPIO_ALT|GPIO_AF2|GPIO_SPEED_50MHz|GPIO_OUTPUT_CLEAR|GPIO_PUSHPULL|GPIO_PORTB|GPIO_PIN7)
 */
PA6 TIM3_CH1 TIM3 PWM(4) GPIO(53)  //M4
PB5 TIM3_CH2 TIM3 PWM(3) GPIO(52)  //M3
PB0 TIM3_CH3 TIM3 PWM(2) GPIO(51)  //M2
PB1 TIM3_CH4 TIM3 PWM(1) GPIO(50)  //M1
PB6 TIM4_CH1 TIM4 PWM(5) GPIO(54)
PB7 TIM4_CH2 TIM4 PWM(6) GPIO(55)



# LED setup is similar to PixRacer
define HAL_HAVE_PIXRACER_LED
#PA7 LED_RED OUTPUT GPIO(0)
PA4 LED_RED OUTPUT GPIO(0)
PB10 LED_GREEN OUTPUT GPIO(1)
PB12 LED_BLUE OUTPUT GPIO(2)

define HAL_GPIO_A_LED_PIN 0
define HAL_GPIO_B_LED_PIN 1
define HAL_GPIO_C_LED_PIN 2

define HAL_GPIO_LED_ON  0
define HAL_GPIO_LED_OFF 1
